#!/usr/bin/perl


use List::Util qw[min max];
my $max_time = $max_action = $max_metadata = $max_scontext = $max_tcontext = $max_tclass = 0;
while(<>)
{
    if(/avc.*denied/ &&
        m/^ *(?<time>[0-9\.]+).*avc: *denied *(?<action>\{.*)\} +(?<metadata>for .*) +(?<scontext>scontext[^\s]+) +(?<tcontext>tcontext[^\s]+) +(?<tclass>tclass[^\s]+) +(?<permissive>permissive=.)/)
    {
        $max_time = max($max_time, length($+{time}));
        $max_action = max($max_action, length($+{action}));
        $max_metadata = max($max_metadata, length($+{metadata}));
        $max_scontext = max($max_scontext, length($+{scontext}));
        $max_tcontext = max($max_tcontext, length($+{tcontext}));
        $max_tclass = max($max_tclass , length($+{tclass}));

        printf "%-${max_time}s %-${max_action}s\} %-${max_metadata}s %-${max_scontext}s %-${max_tcontext}s %-${max_tclass}s %-12s\n",
        $+{time}, $+{action}, $+{metadata}, $+{scontext}, $+{tcontext}, $+{tclass}, $+{permissive};
    }
}
